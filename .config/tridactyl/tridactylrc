" vim: filetype=vim

" This wipes all existing settings. This means that if a setting in this file
" is removed, then it will return to default. In other words, this file serves
" as an enforced single point of truth for Tridactyl's configuration.
" sanitize tridactyllocal tridactylsync

" Just use a blank page for new tab. It would be nicer to use the standard
" Firefox homepage, but Tridactyl doesn't support this yet.
set newtab about:blank
unbind t
bind O fillcmdline tabopen


" Only hint search results on Google and DDG
set hintfiltermode vimperator-reflow
bindurl www.google.com f hint -Jc .rc > .r > a
bindurl www.google.com F hint -Jbc .rc>.r>a
bindurl ^https://duckduckgo.com f hint -Jc [class=result__a]
bindurl ^https://duckduckgo.com F hint -Jbc [class=result__a]

" mpv
" bind v composite hint -pipe a href | exclaim_quiet mpv --ontop --keepaspect-window --profile=protocol.http --force-window=immediate  
" bind V js tri.native.run(`mpv --ontop --force-window=immediate  --keepaspect-window --profile=protocol.http '${document.location.href}'`)
" bind V js tri.native.run(`mpv --force-window=immediate --geometry="800x450" --ytdl-format="best[height=360]" '${document.location.href}'`)

unbind ;v
unbind V
bind ;v composite hint -pipe a href | exclaim_quiet mpv --force-window=immediate --geometry="800x450" --ytdl-format="best[height=360]"
bind V js tri.native.run(`firefox -P vaapi '${document.location.href}'`)
bind F js tri.native.run(`GDK_BACKEND=x11 /usr/bin/firefox -P flash '${document.location.href}'`)

" Use vim in tmux for editor.
set editorcmd terminal -e tmux -u new vim -S /home/andrew/.vim/tridactyl.vim

" Ctrl-F should use the browser's native 'find' functionality.
unbind <C-f>
unbind <C-b>

" But also support Tridactyl search too.
bind / fillcmdline find
bind ? fillcmdline find -?
bind n findnext 1
bind N findnext -1

" Remove search highlighting.
bind ,<Space> nohlsearch
" Use sensitive case. Smart case would be nice here, but it doesn't work.
set findcase smart

" Smooth scrolling, yes please. This is still a bit janky in Tridactyl.
" set smoothscroll true

" The default jump of 10 is a bit much.
"bind j scrollline 5
"bind k scrollline -5

" K and J should move between tabs. x should close them.
bind K tabprev
bind J tabnext
"bind x tabclose

" Don't run Tridactyl on some web sites because it doesn't work well, or
" because the web site has its own keybindings.
" autocmd DocStart mail.google.com mode ignore

" Sometimes the status bar in the bottom left corner overlaps the Tridactyl
" command line, so set an option to move the status bar to the right.
guiset_quiet hoverlink right
guiset_quiet tabs count

" Set up some shortcuts for running custom scripts.
" bind zz composite jsb tri.native.run('cat /home/andrew/.config/tridactyl/rustdoc-condensed.js') | js -p eval(JS_ARG.content)
bind gz composite jsb tri.native.run('cat /home/chewie/espa√±ol/onepiece/mangaplus.js') | js -p eval(JS_ARG.content)


